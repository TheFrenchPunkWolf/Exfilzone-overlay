<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>EXFILZONE</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  background:transparent;
  color:white;
  font-family:Arial Black, sans-serif;
}

.box{
  background:rgba(0,0,0,0.65);
  border:2px solid #2bd2ff;
  box-shadow:0 0 20px #2bd2ff;
  padding:16px;
  width:280px;
}

.stat{
  font-size:28px;
  margin-bottom:6px;
}

.timer{
  font-size:38px;
  color:#ff3cac;
  text-shadow:0 0 10px #ff3cac, 0 0 20px #2bd2ff;
  margin-top:10px;
}
</style>
</head>

<body>

<div class="box">
  <div class="stat">üî• KILLS <span id="kills">0</span></div>
  <div class="stat">üíÄ MORTS <span id="deaths">0</span></div>
  <div class="stat">üéØ RAIDS <span id="raids">0</span></div>
  <div class="stat">üìä K/D <span id="kd">0.00</span></div>
  <div class="timer">‚è± <span id="timer">00:00</span></div>
</div>

<script>
// ================= FIREBASE =================
firebase.initializeApp({
 apiKey: "AIzaSyCfIO5AIHqXT8m134ynF8dr5t-SfNNjA8k",
  databaseURL: "https://exfilzone-overlay-default-rtdb.europe-west1.firebasedatabase.app"
});

const ref = firebase.database().ref("exfilzone");

// ================= DATA =================
let raidStart = 0;
let lastSecond = -1;

// ================= FIREBASE SYNC =================
ref.on("value", snap => {
  const d = snap.val() || {};

  document.getElementById("kills").innerText = d.kills || 0;
  document.getElementById("deaths").innerText = d.deaths || 0;
  document.getElementById("raids").innerText = d.raids || 0;

  const kd = d.deaths ? d.kills / d.deaths : d.kills || 0;
  document.getElementById("kd").innerText = kd.toFixed(2);

  raidStart = d.raidStart || 0;
});

// ================= TIMER OBS (ANTI FREEZE) =================
setInterval(() => {

  // force activit√© Chromium OBS
  document.title = Date.now().toString();

  if (!raidStart) {
    document.getElementById("timer").innerText = "00:00";
    lastSecond = -1;
    return;
  }

  const elapsed = Math.floor((Date.now() - raidStart) / 1000);

  // √©vite rendu inutile
  if (elapsed === lastSecond) return;
  lastSecond = elapsed;

  const minutes = String(Math.floor(elapsed / 60)).padStart(2, "0");
  const seconds = String(elapsed % 60).padStart(2, "0");

  document.getElementById("timer").innerText = `${minutes}:${seconds}`;

}, 500); // 500ms = OBS-safe
</script>

</body>
</html>

